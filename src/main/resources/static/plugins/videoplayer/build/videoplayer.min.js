!function(a,b,c){"function"==typeof define&&(define.cmd||define.amd)?define(function(){return c()}):a.videoPlayer=c()}(window,$,function(){var a={_handlers:"",on:function(a,b){return"object"!=typeof this._handlers&&(this._handlers=[]),this._handlers[a]||(this._handlers[a]=[]),"function"==typeof b&&this._handlers[a].push(b),this},emit:function(a){for(var b=Array.prototype.slice.call(arguments,1),c=this._handlers[a]||[],d=0,e=c.length;e>d;d++)c[d].apply(null,b);return this}},b=function(){this.videos=[]};$.extend(b.prototype,{},{init:function(){},add:function(a,b){var d=this.videos.length,e=new c(a,b,d,this);return this.videos.push(e),e}});var c=function(a,b,c,d){this.index=c,this._parent=d,this.placeholder=$("#"+a),this.src="",this.isPlay,this.params=$.extend({setSource:null,autoPlay:!1,continuousPlay:!1,virtualFullScreen:!0,muted:!1,width:853,height:480,canfast:!1},b),this.init()};$.extend(c.prototype,a,{init:function(){this.render(),this.renderSource(),this.events()},render:function(){this.$warp=$('<div id="mod_yvideo_player_${index}"></div></div>'.replace(/\${.*\}/i,this.index)),this.$el=$('<div class="yvp_container"></div>'),this.placeholder.html(this.$warp),this.$el.appendTo(this.$warp),this.$warp.height(this.params.height),this.$warp.width(this.params.width)},events:function(){}}),$.extend(c.prototype,{videoType:['video/mp4; codecs="avc1.42E01E"','video/ogg; codecs="theora"','video/webm; codecs="vp8, vorbis"'],getCanPlayType:function(){var a,b,c=document.createElement("video");return c.canPlayType?(b=this.videoType[0],a=c.canPlayType(b),""!=a?this._slideType(b):(b=this.videoType[1],a=c.canPlayType(b),""!=a?this._slideType(b):(b=this.videoType[2],a=c.canPlayType(b),""!=a?this._slideType(b):void 0))):!1},_slideType:function(a){return/\/(.*);/i.exec(a)[1]}}),$.extend(c.prototype,{renderSource:function(){var a=this.params.setSource;if(!a)return void this._sourceEmpty();var b=this.getCanPlayType();if(!b)return void this._contSuppotVideo();var c=a(b);this._renderVideo(c),this._videoControl()},_sourceEmpty:function(){},_contSuppotVideo:function(){},_renderVideo:function(a){var b=this.params,c=b.virtualFullScreen,d=$(('<div class="yvp_video"><video width="100%" height="100%" _preload="none" x-webkit-airplay="true" src="${videosrc}" '+(c?"webkit-playsinline":"")+"></video></div>").replace(/\${.*\}/i,a));this.$el.append(d),this.$video=d.find("video")},_videoControl:function(){var a=this.params,b=this;a.autoPlay&&this.$video[0].play(),this.$video.on("pause",function(){b.isPlay=!1}).on("play",function(){b.isPlay=!0}).on("ended",function(){b.isPlay=!1}),this.$video.on("error",function(){b._deadlyError(),$.isFunction(a.error)&&a.error()}).on("loadedmetadata",function(){$.isFunction(a.success)&&a.success(b.$video[0],b.$el,b)}),this.controlsInit()}}),$.extend(c.prototype,{$_continuePlay:"",continueInit:function(){this.$_continuePlay=this.$_progress.find('span[node-type="contp-lay"]'),this._continueEvents()},_continueEvents:function(){var a=this;this.$_continuePlay.on("click",function(){var b=a.params;b.continuousPlay=!b.continuousPlay,a._continueControl(),a.emit("continue",b.continuousPlay)}),a._continueControl()},_continueControl:function(){this.params.continuousPlay?this._continueSelect():this._continueUnSelect()},_continueSelect:function(){this.$_continuePlay.addClass("yvp_contplay_check")},_continueUnSelect:function(){this.$_continuePlay.removeClass("yvp_contplay_check")},getContiune:function(){return this.params.continuousPlay}}),$.extend(c.prototype,{_mouseOnControl:!1,$_control:"",$_membrane:"",$_minprogress:"",controlsInit:function(){this.insertMembrane(),this.renderControls(),this.renderDefProgress(),this.playRender(),this.nextRender(),this.fullScreenRender(),this.mutedRender(),this.progressRender(),this.continueInit(),this.controlEvents()},renderControls:function(){var a=$('<div class="yvp_controls"></div>');this.$el.append(a),this.$_control=a},renderDefProgress:function(){var a=$('<div class="yvp_progress yvp_progress_status"></div>');this.$el.append(a),this.$_minprogress=a},insertMembrane:function(){var a=$('<div class="yvp_membrane"></div>');this.$el.append(a),this.$_membrane=a},controlEvents:function(){var a=(this.$video,this);this.$_membrane.on("click",function(){a._play_on_off()}).on("mousemove",function(){a._controlBar_moveshow()}),this.$video.on("play",function(){a._controlBar_delayhide()}).on("pause",function(){a._controlBar_show()}).on("ended",function(){a._controlBar_show()}),this.$_control.on("mouseover",function(){a._mouseOnControl=!0,clearTimeout(a._timer)}).on("mouseleave",function(){a._mouseOnControl=!1,a._controlBar_delayhide()})},_controlBar_show:function(){this._hideConbar||this.$el.removeClass("yvp_container_hide")},_controlBar_hide:function(){this.$el.addClass("yvp_container_hide")},_timer:"",_moveshow:"",_controlBar_delayhide:function(){var a=this;this.isPlay&&(this._mouseOnControl||(clearTimeout(a._timer),a._timer=setTimeout(function(){a._controlBar_hide()},3e3)))},_controlBar_moveshow:function(){var a=this;return a._moveshow>0?(clearTimeout(a._moveshow),clearTimeout(a._timer),void(a._moveshow=setTimeout(function(){a._controlBar_delayhide(),a._moveshow=""},0))):(this._controlBar_show(),void(this._moveshow=1))}}),$.extend(c.prototype,{$_playbtn:"",$_playFullBtn:"",playRender:function(){var a=$('<div class="yvp_button yvp_play_pause">                    <div class="yvp_button_under"></div>                    <button type="button" title="播放/暂停">                        <span class="yvp_btn_val">                        </span>                    </button>                </div>');this.$_control.append(a);var b=$('<a href="javascript:;" class="yvp_overlay_play">                <span class="yvp_button_play"></a>            </div>');this.$el.append(b),this.$_playbtn=a,this.$_playFullBtn=b,this._playControl()},_playControl:function(){var a=this,b=this.$video;b.on("pause",function(){a._playChangeStatus()}),b.on("play",function(){a._playChangeStatus()}),this.$_playbtn.on("click","button",function(){a._play_on_off()}),this.$_playFullBtn.on("click",function(){a._play_on_off()}),this._playChangeStatus()},_play_on_off:function(){var a=this,b=a.$video;a._hideConbar||(b[0].paused?b[0].play():b[0].pause())},play:function(a){"boolean"==typeof a&&a&&(this._hideConbar=!1),this.$video[0].play()},pause:function(a){"boolean"==typeof a&&a?(this._hideConbar=!0,this._controlBar_hide()):this._hideConbar=!1,this.$video[0].pause()},_playChangeStatus:function(){var a=this.$video;if(a[0].paused){if(this._play_playicon(),this._hideConbar)return;this.$_playFullBtn.show()}else this._play_puaseicon(),this.$_playFullBtn.hide()},_play_playicon:function(){var a=this.$_playbtn.find(".yvp_btn_val");a.html('<em class="yvphicon yvphicon-play"></em>')},_play_puaseicon:function(){var a=this.$_playbtn.find(".yvp_btn_val");a.html('<em class="yvphicon yvphicon-pause"></em>')}}),$.extend(c.prototype,{$_nextobj:"",nextRender:function(){var a=$('<div class="yvp_button yvp_next">                    <div class="yvp_button_under"></div>                    <button type="button" title="next">                        <span class="yvp_btn_val">                            <em class="yvphicon yvphicon-next"></em>                        </span>                    </button>                </div>');this.$_control.append(a),this.$_nextobj=a,this._nextControl()},_nextControl:function(){var a=this;this.$_nextobj.on("click touchStart",function(){a.emit("next")})}}),$.extend(c.prototype,{$_fullscreen:"",_isFullScreen:!1,fullScreenRender:function(){var a=$('<div class="yvp_button yvp_fullscreen">                    <div class="yvp_button_under"></div>                    <button type="button" title="full_screen">                        <span class="yvp_btn_val">                            <em class="yvphicon yvphicon-fullscreen"></em>                        </span>                    </button>                </div>');this.$_control.append(a),this.$_fullscreen=a,this._fullScreenControl()},_fullScreenObj:"",_fullScreenControl:function(){var a=this,b=this.params;this._fullScreenObj=new i(a),this.$_fullscreen.on("click","button",function(){b.virtualFullScreen?a._isFullScreen?a.unFullScreen():a.fullScreen():a._fullscreen_defaultFull()})},fullScreen:function(){this._fullScreenObj.enterFullScreen(),this._fullscreen_nfullicon(),this._isFullScreen=!0},unFullScreen:function(){this._fullScreenObj.cancelFullScreen(),this._fullscreen_fullicon(),this._isFullScreen=!1},_fullscreen_nfullicon:function(){var a=this,b=a.$_fullscreen.find(".yvp_btn_val");b.html('<em class="yvphicon yvphicon-cancelscreen"></em>')},_fullscreen_fullicon:function(){var a=this,b=a.$_fullscreen.find(".yvp_btn_val");b.html('<em class="yvphicon yvphicon-fullscreen"></em>')},_fullscreen_defaultFull:function(){var a=document.createElement("video");return a.mozRequestFullScreen?function(){var a=this;a.$video[0].mozRequestFullScreen()}:a.webkitEnterFullScreen?function(){var a=this;a.$video[0].webkitEnterFullScreen()}:function(){alert("can not enter fullscreen")}}()}),$.extend(c.prototype,{$_muted:"",$_muted_bar:"",$_muted_flag:"",mutedRender:function(){var a=this,b=$('<div class="yvp_button yvp_muted">                    <div class="yvp_button_under"></div>                    <div class="yvp_muted_warp">                            <div class="muted_barwarp">                                <div class="muted_arrow_b">                                    <span class="yvp_muted_tbg"></span>                                </div>                                <div class="muted_arrow_b muted_arrow_u" node-type="volum_flag">                                    <span class="yvp_muted_tbg"></span>                                </div>                                <a href="javascript:;" class="muted_ribtn" node-type="volum_cbar"></a>                            </div>                        </div>                    <button type="button" title="muted">                        <span class="yvp_btn_val">                            <em class="yvphicon yvphicon-muted"></em>                        </span>                    </button>                </div>');a.$_control.append(b),a.$_muted=b,a.$_muted_bar=b.find('a[node-type="volum_cbar"]'),a.$_muted_flag=b.find('div[node-type="volum_flag"]'),a.$volumHeight=b.find(".muted_barwarp").height(),a._mutedControl()},_mutedControl:function(){var a=this,b=a.$video,c=a.params;this.$_muted.on("mousemove",function(){a.$_muted.addClass("yvp_muted_over")}).on("mouseout",function(){a.$_muted.removeClass("yvp_muted_over")}),b.on("volumechange",function(){b[0].muted?a._mutedunSet():(a._mutedSet(),a._muted_setVolum())}),this.$_muted.find(".yvp_btn_val").on("click",function(){1==b[0].muted?b[0].muted=!1:b[0].muted=!0,a._mutedSet()});new f(a.$_muted_bar,function(b,c,d){a._mutedVolume(b,c,d)});b[0].muted=c.muted,a._muted_setVolum()},_mutedSet:function(){var a=this,b=a.$_muted.find(".yvp_btn_val");b.html('<em class="yvphicon yvphicon-muted"></em>')},_mutedunSet:function(){var a=this,b=a.$_muted.find(".yvp_btn_val");b.html('<em class="yvphicon yvphicon-nomuted"></em>')},_muted_setVolum:function(){var a=this,b=a.$volumHeight,c=a.$video[0].volume,d=1-c,e=b*c;this.$_muted_bar.css({bottom:e}),this.$_muted_flag.css({height:100*d+"%"})},_mutedVolume:function(a,b,c){var d=this,e=d.$volumHeight,f=c.bottom-b;f>e&&(f=e),0>f&&(f=0),this.$video[0].volume=f/e}}),$.extend(c.prototype,{$_progress:"",$_progressBtn:"",progressRender:function(){var a=$('<div class="yvp_prograss_wrap">                    <div class="yvp_progress">                        <span class="yvp_time_panel yvp_time_panel_curr" node-type="curr-time"></span>                        <span class="yvp_time_panel yvp_time_panel_total" node-type="total-time"></span>                        <span class="yvp_time_total" node-node="prog-rail">                            <span class="yvp_time_loaded" node-type="buffer"></span>                            <span class="yvp_time_current" node-type="progress-bar">                            </span>                             <a href="javascript:;" class="yvp_time_handle" node-type="progpress-btn"></a>                        </span>                            </div>                </div>'),b=$('<span class="yvp_time_total">                    <span class="yvp_time_loaded" node-type="buffer"></span>                    <span class="yvp_time_current" node-type="progress-bar">                    </span>                </span>');this.$_control.append(a),this.$_minprogress.append(b),this.$_progress=a,this.$_progressBtn=a.find('a[node-type="progpress-btn"]'),this._progressControl()},_progressControl:function(){var a=this,b=this.$video;b.on("timeupdate",function(){a._updataCurrentTime(a._formateTime(b[0].currentTime)),a._updataPlayProgress(b[0].currentTime)}),b.on("loadedmetadata",function(){a._updataTotalTime(a._formateTime(b[0].duration))}),b.on("progress",function(){var c=b[0].buffered;1==c.length&&a._updataBufferProgress(c.start(0),c.end(0))});new f(this.$_progressBtn,function(b,c,d){a._progressBtnControl(b,c,d)});this._updataCurrentTime(a._formateTime(b[0].currentTime)),this._updataTotalTime(a._formateTime(b[0].duration))},_formateTime:function(a){var b=Math.ceil(a);return[b/3600|0,b/60%60|0,b%60|0].join(":").replace(/\b(\d)\b/g,"0$1").replace(/^0{1,2}\:*/,"")},_updataCurrentTime:function(a){this.$_currTimeNode||(this.$_currTimeNode=this.$_progress.find('span[node-type="curr-time"]')),this.$_currTimeNode.text(a)},_updataTotalTime:function(a){this.$_totalTimeNode||(this.$_totalTimeNode=this.$_progress.find('span[node-type="total-time"]')),this.$_totalTimeNode.text(a)},_updataBufferProgress:function(a,b){this.$_totalBuffer||(this.$_totalBuffer=this.$_progress.find('span[node-type="buffer"]')),this.$_mintotalBuffer||(this.$_mintotalBuffer=this.$_minprogress.find('span[node-type="buffer"]'));var c=this.$video,d=b/c[0].duration*100;this.$_totalBuffer.width(d+"%"),this.$_mintotalBuffer.width(d+"%")},_updataPlayProgress:function(){this.$_playProgress||(this.$_playProgress=this.$_progress.find('span[node-type="progress-bar"]')),this.$_progRailObj||(this.$_progRailObj=this.$_progress.find('span[node-node="prog-rail"]')),this.$_minPlayProgress||(this.$_minPlayProgress=this.$_minprogress.find('span[node-type="progress-bar"]'));var a=this.$video,b=a[0].currentTime/a[0].duration;this.$_playProgress.width(100*b+"%"),this.$_progressBtn.css({left:100*b+"%"}),this.$_minPlayProgress.width(100*b+"%")},_progressBtnControl:function(a,b,c){this.$_progRailObj||(this.$_progRailObj=this.$_progress.find('span[node-node="prog-rail"]'));var d=this.$video,e=this.$_progRailObj.width(),f=(this.$_progressBtn,c.left+a);0>f&&(f=0),f>e&&(f=e);var g=f/e*d[0].duration;return this.params.canfast===!1&&g>d[0].currentTime?!1:(d[0].currentTime=g,this._updataCurrentTime(this._formateTime(g)),void this._updataPlayProgress())},timeupdate:function(a){var b,c=this,e=c.$video,f=d();e.on("timeupdate",function(){b=e[0].currentTime,f(b,function(){$.isFunction(a),a(0|b)})})},setCurrentTime:function(a){0>a||a>this.$video[0].duration||(this.$video[0].currentTime=a)}});var d=function(){var a="";return function(b,c){var d=0|b;d!=a&&(c&&c(d),a=d)}};$.extend(c.prototype,{$deadly:"",_deadlyError:function(){var a='<div class="yvp_deadly_error">                <div class="yvp_deadly_errtxt">                    <span class="yvphicon yvphicon-unhappy"></span>                    <span class="yvp_deadly_tip">${errorTxt}</span>                </div>            </div>',b=this._deadlyMsg();this.$el.append(a.replace("${errorTxt}",b))},_deadlyErrorControl:function(){},_deadlyMsg:function(){var a=this,b=a.$video,c="";switch(b[0].error.code){case 1:c="用户终止错误";break;case 2:c="网络发生未知错误";break;case 3:c="视频解码错误";break;case 4:c="视频地址错误";break;default:c="未知错误"}return c+"("+b[0].error.code+")"}});var e=$(document),f=function(a,b){this.target=a,this.random=(1e4*Math.random()*8|0).toString(16),this.whenmousedown=null,this.wnenmouseup=null,this.oldPos,this.oldmouse,this.oldLT,this.groupStatus=!1,this.callback=b,this.init()};$.extend(f.prototype,{init:function(){var a=this;this.target.css({cursor:"pointer"}),this.target.on("mousedown."+this.random,function(b){a._mousedown(b),a.oldLT={left:parseInt(a.target.css("left")),top:parseInt(a.target.css("top")),bottom:parseInt(a.target.css("bottom")),right:parseInt(a.target.css("right"))},"function"==typeof a.whenmousedown&&a.whenmousedown(),a.groupStatus=!0,e.on("mousemove."+a.random,function(b){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),a.groupStatus&&a._mousemove(b)}).on("mouseup."+a.random,function(b){a._mouseup()})})},_mousedown:function(a){a.preventDefault(),a.stopPropagation(),this.groupStatus=!0,this.oldmouse={x:a.clientX,y:a.clientY}},_mousemove:function(a){var b={x:a.clientX,y:a.clientY},c=b.x-this.oldmouse.x,d=b.y-this.oldmouse.y;"function"==typeof this.callback&&this.callback(c,d,this.oldLT)},_mouseup:function(){var a=this;a.groupStatus=!1,e.unbind("mousemove."+a.random),e.unbind("mouseup."+a.random),"function"==typeof a.wnenmouseup&&a.wnenmouseup()},mousedown:function(a){return"function"==typeof a?void(this.whenmousedown=a):void 0},mouseup:function(a){return"function"==typeof a?void(this.wnenmouseup=a):void 0}});var g=$("body"),h=$(window),i=function(a){this.$mask,this.video=a,this.playStatus=!1,this.bodyOf=g.css("overflow")};$.extend(i.prototype,{events:function(){var a=this;h.on("resize",function(){a._setWarpInfo()})},_setWarpInfo:function(){var a=this.$mask.width(),b=this.$mask.height(),c=this.video.params,d=c.width/c.height,e=.9*a;320>e&&(e=320);var f=e/d;this.$warp.width(e),this.$warp.height(f),this.$warp.css({"padding-top":(b-f)/2})},enterFullScreen:function(){this._insertMask(),this.video.$el.appendTo(this.$warp),this._setWarpInfo(),this.events()},cancelFullScreen:function(){this.video.$el.appendTo(this.video.$warp),this._removeMask()},_insertMask:function(){g.css({overflow:"hidden"});var a=$('<div class="yvp_fullscreen_mask"></div>');g.append(a),this.$mask=a,this._insertVideoWarp()},_insertVideoWarp:function(){this.$warp=$('<div class="yvp_fullscreen_vwarp"></div>'),this.$mask.append(this.$warp)},_removeMask:function(){this.$warp.remove(),this.$mask.remove(),g.css({overflow:this.bodyOf})}});var j=new b;return function(a,b){return j.add(a,b)}});